// Ion.Zoom
// version 1.2.63
// http://ionden.com/a/plugins/ion.zoom/
(function(e){var t=0;var n='<div class="ion-zoom-preloader"></div>';n+='<div class="ion-zoom-image">';n+='<div class="ion-zoom-close"><div>&times;</div></div>';n+='<div class="ion-zoom-prev"><div></div></div>';n+='<div class="ion-zoom-next"><div></div></div>';n+="</div>";var r=e(document.body),i=e(window),s,o,u,a;r.append(n);s=e("div.ion-zoom-preloader");o=e("div.ion-zoom-image");u=e("div.ion-zoom-prev");a=e("div.ion-zoom-next");var f=[],l=false,c=0;var h={init:function(n){var h=this;if(h.data("isActive")){return}t=t+1;this.pluginCount=t;f[this.pluginCount]=this;var p=e.extend({visibleControls:true},n);h.each(function(t){e(this).data("isActive",true).data("iznum",t)});var d=false,v=false,m=h.length,g={},y={},b=0,w,E,S="";var x,T,N;this.closeZoom=function(e){L(false,e)};var C=function(){h.on("click",function(t){t.preventDefault();var n=e(this);b=n.data("iznum");if(d){T=n;E=n.prop("href");L(true)}else if(l){I(n)}else{x=n;w=n.prop("href");k();M()}});r.on("keydown",function(e){if(e.which===27&&d){L()}if(e.which===37&&d&&!v){A()}if(e.which===39&&d&&!v){O()}})};var k=function(){o.on("click",function(){L()});if(p.visibleControls){u.on("click",function(e){e.stopPropagation();if(d&&!v){A()}});a.on("click",function(e){e.stopPropagation();if(d&&!v){O()}})}};var L=function(e,t){if(e){B(y.x,y.y,y.w,y.h,true,true,t)}else{B(y.x,y.y,y.w,y.h,true,false,t)}};var A=function(){b=b-1;var e=h.eq(b);if(!e.length){b=m-1;e=h.eq(m-1)}T=e;E=e.prop("href");L(true)};var O=function(){b=b+1;var e=h.eq(b);if(!e.length){b=0;e=h.eq(0)}T=e;E=e.prop("href");L(true)};var M=function(){var e={linkBorder:parseInt(x.css("border-left-width")),linkPadding:parseInt(x.css("padding-left")),imgBorder:parseInt(x.children("img").css("border-left-width")),imgPadding:parseInt(x.children("img").css("padding-left"))};var t=e.linkBorder+e.linkPadding;var n=e.imgBorder+e.imgPadding;y={x:x.offset().left+t+n,y:x.offset().top+t+n,w:x.width()-n*2,h:x.height()-n*2};_();D()};var _=function(){var e=y.x+y.w/2;var t=y.y+y.h/2;s.css("top",t).css("left",e)};var D=function(){if(x.children("img").attr("alt")==undefined){S="";o.append('<img src="'+w+'" />')}else{S=x.children("img").attr("alt");o.append('<img src="'+w+'" alt="'+S+'"/><div class="ion-zoom-text"><div>'+S+"</div></div>")}N=o.children("img");N.on("load",function(){g.w=N.width();g.h=N.height();P()})};var P=function(){s.css("top","-9999px").css("left","-9999px");N.width(y.w).height(y.h);o.width(y.w).height(y.h);o.css("left",y.x).css("top",y.y);H()};var H=function(){var e=i.innerWidth()-40;var t=i.innerHeight()-40;var n=i.scrollTop();var r=g.h/g.w;var s=y.x+y.w/2-g.w/2;var o=y.y+y.h/2-g.h/2;var u=g.w;var a=g.h;if(u>e){u=e;a=e*r;s=y.x+y.w/2-u/2}if(a>t){a=t;u=t/r;s=y.x+y.w/2-u/2}if(s+u>e){s=e-u-20}if(o+a>20+n+t){o=n+t-a}if(s<20){s=20}if(o<n+20){o=n+20}B(s,o,u,a,false,false)};var B=function(e,t,n,r,i,s,u){v=true;o.removeClass("isOpen");if(!p.visibleControls){o.removeClass("noControls")}o.stop().animate({left:e,top:t,width:n,height:r},{step:function(e,t){if(t.prop==="width"){N.width(e+"px")}if(t.prop==="height"){N.height(e+"px")}},duration:300,complete:function(){if(i){F();if(s){j()}if(u){u()}}else{o.addClass("isOpen");if(!p.visibleControls){o.addClass("noControls")}l=true;d=true;c=h.pluginCount}v=false}})};var j=function(){x=T;w=E;M()};var F=function(){o.css("top","-9999px").css("left","-9999px");o.width("0px").height("0px");o.children("img").remove();d=false;l=false;S=""};var I=function(e){var t=function(){x=e;w=e.prop("href");k();M()};f[c].closeZoom(t)};C()},close:function(){for(var e=1;e<f.length;e++){f[e].closeZoom()}}};e.fn.ionZoom=function(t){if(h[t]){return h[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return h.init.apply(this,arguments)}else{e.error("Method "+t+" does not exist for jQuery.ionZoom")}}})(jQuery)
